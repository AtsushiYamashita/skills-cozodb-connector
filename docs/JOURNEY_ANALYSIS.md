# CozoDB Product Journey Analysis

æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€CozoDBã‚’ä½¿ç”¨ã™ã‚‹ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ã€Œé–‹ç™ºè€…ã‚¸ãƒ£ãƒ¼ãƒ‹ãƒ¼ã€ã¨ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¸ãƒ£ãƒ¼ãƒ‹ãƒ¼ã€ã‚’åˆ†æã—ã€SkillãŒè§£æ±ºã™ã¹ãå•é¡Œã‚’ç²¾ç·»åŒ–ã™ã‚‹ã€‚

---

## é–‹ç™ºè€…ã‚¸ãƒ£ãƒ¼ãƒ‹ãƒ¼ (Developer Journey)

### ãƒ•ã‚§ãƒ¼ã‚º1: æŠ€è¡“é¸å®š

```
[èª²é¡Œèªè­˜] â†’ [CozoDBç™ºè¦‹] â†’ [è©•ä¾¡] â†’ [æ¡ç”¨æ±ºå®š]
```

| ã‚¹ãƒ†ãƒƒãƒ— | é–‹ç™ºè€…ã®è¡Œå‹•                                 | ç™ºç”Ÿã™ã‚‹å•é¡Œ                        | SkillãŒè§£æ±ºã™ã¹ãã‹ |
| -------- | -------------------------------------------- | ----------------------------------- | ------------------- |
| èª²é¡Œèªè­˜ | ã€Œçµ„ã¿è¾¼ã¿DBãŒæ¬²ã—ã„ã€ã€Œã‚°ãƒ©ãƒ•ã‚¯ã‚¨ãƒªã—ãŸã„ã€ | -                                   | No (å¤–éƒ¨è¦å› )       |
| ç™ºè¦‹     | CozoDBå…¬å¼ã‚µã‚¤ãƒˆ/GitHubé–²è¦§                  | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒè‹±èªã®ã¿              | No (å…¬å¼ã®å•é¡Œ)     |
| è©•ä¾¡     | ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œ                           | Datalogæ§‹æ–‡ãŒåˆ†ã‹ã‚‰ãªã„             | **Yes**             |
| è©•ä¾¡     | Node/WASMå‹•ä½œç¢ºèª                            | ç’°å¢ƒæ§‹ç¯‰ã§ãƒãƒã‚‹                    | **Yes**             |
| æ¡ç”¨æ±ºå®š | è¦ä»¶ã¨ã®é©åˆç¢ºèª                             | ã€Œã§ãã‚‹ã“ã¨/ã§ããªã„ã“ã¨ã€ãŒä¸æ˜ç¢º | **Yes**             |

### ãƒ•ã‚§ãƒ¼ã‚º2: åˆæœŸå®Ÿè£…

```
[ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š] â†’ [ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ] â†’ [CRUDå®Ÿè£…] â†’ [å‹•ä½œç¢ºèª]
```

| ã‚¹ãƒ†ãƒƒãƒ—         | é–‹ç™ºè€…ã®è¡Œå‹•              | ç™ºç”Ÿã™ã‚‹å•é¡Œ                   | SkillãŒè§£æ±ºã™ã¹ãã‹ |
| ---------------- | ------------------------- | ------------------------------ | ------------------- |
| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š | npm install, åˆæœŸåŒ–ã‚³ãƒ¼ãƒ‰ | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é¸æŠã«è¿·ã†         | **Yes**             |
| ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ     | :createæ–‡ä½œæˆ             | Datalogå‹ã‚·ã‚¹ãƒ†ãƒ ãŒä¸æ˜        | **Yes**             |
| CRUDå®Ÿè£…         | put/rm/queryä½œæˆ          | Datalogæ§‹æ–‡ã‚¨ãƒ©ãƒ¼å¤šç™º          | **Yes**             |
| å‹•ä½œç¢ºèª         | ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ                | ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒåˆ†ã‹ã‚Šã«ãã„ | **Yes**             |

### ãƒ•ã‚§ãƒ¼ã‚º3: PWAå¯¾å¿œ (Browser WASM)

```
[WASMå°å…¥] â†’ [æ°¸ç¶šåŒ–æ¤œè¨] â†’ [ãƒ¡ãƒ¢ãƒªç®¡ç†] â†’ [ã‚µãƒ¼ãƒãƒ¼åŒæœŸ]
```

| ã‚¹ãƒ†ãƒƒãƒ—     | é–‹ç™ºè€…ã®è¡Œå‹•              | ç™ºç”Ÿã™ã‚‹å•é¡Œ               | SkillãŒè§£æ±ºã™ã¹ãã‹ |
| ------------ | ------------------------- | -------------------------- | ------------------- |
| WASMå°å…¥     | cozo-lib-wasmè¨­å®š         | CDN vs ãƒãƒ³ãƒ‰ãƒ«é¸æŠ        | **Yes**             |
| æ°¸ç¶šåŒ–æ¤œè¨   | IndexedDBæ¤œè¨             | **æ®ç™ºæ€§ã®èªè­˜ä¸è¶³**       | **Yes** (é‡è¦)      |
| ãƒ¡ãƒ¢ãƒªç®¡ç†   | å¤§é‡ãƒ‡ãƒ¼ã‚¿æŠ•å…¥            | **ãƒ¡ãƒ¢ãƒªæº¢ã‚Œã§ã‚¯ãƒ©ãƒƒã‚·ãƒ¥** | **Yes** (é‡è¦)      |
| ã‚µãƒ¼ãƒãƒ¼åŒæœŸ | ã‚ªãƒ•ãƒ©ã‚¤ãƒ³â†’ã‚ªãƒ³ãƒ©ã‚¤ãƒ³åŒæœŸ | åŒæœŸè¨­è¨ˆãŒä¸æ˜             | **Yes**             |

### ãƒ•ã‚§ãƒ¼ã‚º4: æœ¬ç•ªé‹ç”¨

```
[ãƒãƒ«ãƒãƒ¦ãƒ¼ã‚¶ãƒ¼] â†’ [ã‚¹ã‚±ãƒ¼ãƒ«] â†’ [ç›£è¦–] â†’ [éšœå®³å¯¾å¿œ]
```

| ã‚¹ãƒ†ãƒƒãƒ—       | é–‹ç™ºè€…ã®è¡Œå‹•     | ç™ºç”Ÿã™ã‚‹å•é¡Œ         | SkillãŒè§£æ±ºã™ã¹ãã‹  |
| -------------- | ---------------- | -------------------- | -------------------- |
| ãƒãƒ«ãƒãƒ¦ãƒ¼ã‚¶ãƒ¼ | ãƒ†ãƒŠãƒ³ãƒˆåˆ†é›¢è¨­è¨ˆ | è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ãŒä¸æ˜   | **Yes**              |
| ã‚¹ã‚±ãƒ¼ãƒ«       | ãƒ‡ãƒ¼ã‚¿é‡å¢—åŠ      | ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŠ£åŒ–   | Partial (ã‚¬ã‚¤ãƒ‰ã®ã¿) |
| ç›£è¦–           | ãƒ­ã‚°ãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | ç›£è¦–æ–¹æ³•ä¸æ˜         | No (ã‚¹ã‚³ãƒ¼ãƒ—å¤–)      |
| éšœå®³å¯¾å¿œ       | ãƒ‡ãƒ¼ã‚¿å¾©æ—§       | ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ–¹æ³•ä¸æ˜ | Partial              |

---

## ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¸ãƒ£ãƒ¼ãƒ‹ãƒ¼ (User Journey)

### ã‚·ãƒŠãƒªã‚ª: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¢ãƒ—ãƒª

```
[åˆå›èµ·å‹•] â†’ [ãƒãƒ¼ãƒˆä½œæˆ] â†’ [ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç·¨é›†] â†’ [ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¾©å¸°] â†’ [é•·æœŸåˆ©ç”¨]
```

| ã‚¹ãƒ†ãƒƒãƒ—       | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¡Œå‹•   | ç™ºç”Ÿã™ã‚‹å•é¡Œ           | é–‹ç™ºè€…ãŒè§£æ±ºã™ã¹ã | SkillãŒæ”¯æ´ã™ã¹ã      |
| -------------- | ---------------- | ---------------------- | ------------------ | ---------------------- |
| åˆå›èµ·å‹•       | ã‚¢ãƒ—ãƒªé–‹ã       | åˆæœŸåŒ–ãŒé…ã„(WASM)     | Yes                | **èª­è¾¼ã¿æœ€é©åŒ–ã‚¬ã‚¤ãƒ‰** |
| ãƒãƒ¼ãƒˆä½œæˆ     | æ–‡ç« å…¥åŠ›ãƒ»ä¿å­˜   | -                      | -                  | -                      |
| ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç·¨é›† | æ©Ÿå†…ãƒ¢ãƒ¼ãƒ‰ã§ç·¨é›† | -                      | -                  | -                      |
| ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¾©å¸° | WiFiæ¥ç¶š         | **ãƒ‡ãƒ¼ã‚¿åŒæœŸã•ã‚Œãªã„** | Yes                | **åŒæœŸãƒ‘ã‚¿ãƒ¼ãƒ³æä¾›**   |
| é•·æœŸåˆ©ç”¨       | å¤§é‡ãƒãƒ¼ãƒˆè“„ç©   | **ã‚¢ãƒ—ãƒªãŒé‡ããªã‚‹**   | Yes                | **ãƒ¡ãƒ¢ãƒªç®¡ç†æˆ¦ç•¥**     |
| é•·æœŸåˆ©ç”¨       | ãƒ–ãƒ©ã‚¦ã‚¶æ›´æ–°     | **ãƒ‡ãƒ¼ã‚¿æ¶ˆå¤±**         | Yes                | **æ°¸ç¶šåŒ–å¿…é ˆã®è­¦å‘Š**   |

---

## è­˜åˆ¥ã•ã‚ŒãŸé‡è¦å•é¡Œ

### ğŸ”´ Critical (Skillå¿…é ˆå¯¾å¿œ)

1. **WASMæ®ç™ºæ€§ã®èªè­˜ä¸è¶³**
   - é–‹ç™ºè€…ãŒã€Œãƒ–ãƒ©ã‚¦ã‚¶DBã¯æ°¸ç¶šã€ã¨èª¤è§£
   - â†’ æ˜ç¢ºãªè­¦å‘Š + å¿…é ˆã®æ°¸ç¶šåŒ–ãƒ‘ã‚¿ãƒ¼ãƒ³æä¾›

2. **ãƒ¡ãƒ¢ãƒªæº¢ã‚Œå¯¾ç­–ãªã—**
   - æ›¸ãè¾¼ã¿é‡ã‚’ã‚«ã‚¦ãƒ³ãƒˆã—ã¦ã„ãªã„
   - â†’ æ›¸ãè¾¼ã¿é‡ç›£è¦– + ã‚µãƒ¼ãƒãƒ¼ã‚ªãƒ•ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½

3. **ã‚µãƒ¼ãƒãƒ¼åŒæœŸãƒ‘ã‚¿ãƒ¼ãƒ³ä¸åœ¨**
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ãŒãƒ­ãƒ¼ã‚«ãƒ«ã®ã¿
   - â†’ åŒæœŸAPIè¨­è¨ˆã‚¬ã‚¤ãƒ‰ + å®Ÿè£…ã‚µãƒ³ãƒ—ãƒ«

### ğŸŸ¡ Important (Skillæ¨å¥¨å¯¾å¿œ)

4. **Datalogå­¦ç¿’æ›²ç·š**
   - SQLçµŒé¨“è€…ãŒ Datalog ã§èº“ã
   - â†’ SQLâ†’Datalogå¤‰æ›ã‚¬ã‚¤ãƒ‰

5. **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®i18n**
   - ã‚¨ãƒ©ãƒ¼ãŒè‹±èªã§åˆ†ã‹ã‚Šã«ãã„
   - â†’ ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ + ç¿»è¨³å¯èƒ½ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

6. **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é¸æŠã‚¬ã‚¤ãƒ‰**
   - Memory/SQLite/RocksDB ã®ä½¿ã„åˆ†ã‘ä¸æ˜
   - â†’ åˆ¤æ–­ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ

---

## ã‚¹ã‚³ãƒ¼ãƒ—å†å®šç¾©

### ç¾è¡Œã‚¹ã‚³ãƒ¼ãƒ— vs æ–°ã‚¹ã‚³ãƒ¼ãƒ—

| é …ç›®               | ç¾è¡Œ         | æ–°ï¼ˆè¿½åŠ ï¼‰    |
| ------------------ | ------------ | ------------- |
| Datalogæ§‹æ–‡ã‚¬ã‚¤ãƒ‰  | âœ…           | -             |
| ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æ¯”è¼ƒ   | âœ…           | -             |
| ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° | âœ…           | -             |
| æ®ç™ºæ€§è­¦å‘Š         | âŒ           | **âœ… æ˜ç¢ºåŒ–** |
| ãƒ¡ãƒ¢ãƒªç›£è¦–         | âŒ           | **âœ… è¿½åŠ **   |
| ã‚µãƒ¼ãƒãƒ¼ã‚ªãƒ•ãƒ­ãƒ¼ãƒ‰ | âŒ           | **âœ… è¿½åŠ **   |
| åŒæœŸãƒ‘ã‚¿ãƒ¼ãƒ³       | â–³ (Journey4) | **âœ… å¼·åŒ–**   |

### æ–°æ©Ÿèƒ½ææ¡ˆ

#### 1. ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç›£è¦– + ã‚ªãƒ•ãƒ­ãƒ¼ãƒ‰

```javascript
const createMemoryAwareDb = (db, options = {}) => {
  const { maxBytes = 50 * 1024 * 1024, onOverflow } = options; // 50MB default
  let bytesWritten = 0;

  const trackingExecutor = {
    async put(query, data) {
      const dataSize = JSON.stringify(data).length * 2; // UTF-16
      bytesWritten += dataSize;

      if (bytesWritten > maxBytes && onOverflow) {
        await onOverflow(bytesWritten);
      }

      return db.run(query);
    },

    getUsage: () => bytesWritten,
    resetUsage: () => {
      bytesWritten = 0;
    },
  };

  return trackingExecutor;
};
```

#### 2. å¿…é ˆã‚µãƒ¼ãƒãƒ¼åŒæœŸãƒ˜ãƒ«ãƒ‘ãƒ¼

```javascript
const createSyncManager = (localDb, serverUrl) => {
    let lastSyncTime = 0;

    return {
        // ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ›´ã‚’ã‚µãƒ¼ãƒãƒ¼ã¸
        async pushChanges(tableName, since) { ... },

        // ã‚µãƒ¼ãƒãƒ¼å¤‰æ›´ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã¸
        async pullChanges(tableName, since) { ... },

        // åŒæ–¹å‘åŒæœŸ
        async sync(tableName) { ... },

        // æ®ç™ºæ€§è­¦å‘Šä»˜ãåˆæœŸåŒ–
        async init() {
            console.warn('[CozoDB] WASM data is VOLATILE. Call sync() regularly.');
        }
    };
};
```

---

## æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

1. [ ] ãƒ¡ãƒ¢ãƒªç›£è¦–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä½œæˆ (`scripts/memory-monitor.js`)
2. [ ] åŒæœŸãƒ˜ãƒ«ãƒ‘ãƒ¼å¼·åŒ– (`scripts/sync-helper.js`)
3. [ ] README/SKILL.md ã«æ®ç™ºæ€§è­¦å‘Šã‚’è¿½åŠ 
4. [ ] ã‚¹ã‚³ãƒ¼ãƒ—ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ›´æ–°
